"use strict";(self.webpackChunklapaa=self.webpackChunklapaa||[]).push([[377],{8980:function(e,n,t){t.r(n);var r=t(4942),a=t(1413),c=t(3433),i=t(4165),o=t(5861),s=t(9439),u=t(2791),d=t(7027),l=t(2014),f=t(5848),Z=t(7309),m=t(6106),p=t(914),h=t(814),x=t(7615),v=t(376),_=t(9286),k=t(1933),w=t(184);n.default=function(){var e=(0,u.useState)(!1),n=(0,s.Z)(e,2),t=n[0],y=n[1],g=(0,u.useState)([]),j=(0,s.Z)(g,2),C=j[0],P=j[1],I=(0,u.useState)([]),R=(0,s.Z)(I,2),b=R[0],E=R[1],S=(0,u.useState)({}),F=(0,s.Z)(S,2),N=F[0],T=F[1],M=(0,u.useRef)(null);(0,u.useEffect)((function(){var e=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,k.ZP)("user/roles/list/","GET",{});case 3:"success"===(n=e.sent).status?(P(n.data),console.log("Roles and Permissions:",n.data)):d.ZP.error("Failed to load roles and permissions"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d.ZP.error("Error fetching roles and permissions: "+e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e();var n=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var n,t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,k.ZP)("user/modules/list/","GET",{});case 3:"success"===(n=e.sent).status?(t=n.data.map((function(e){return{module:e,can_create:!1,can_view:!1,can_edit:!1,can_delete:!1}})),E(t)):d.ZP.error("Failed to load modules"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d.ZP.error("Error fetching modules: "+e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();n()}),[]);var z=function(e,n,t){P((function(c){return c.map((function(c){return c.id===e?(0,a.Z)((0,a.Z)({},c),{},{permissions:c.permissions.map((function(e,c){return c===n?(0,a.Z)((0,a.Z)({},e),{},(0,r.Z)({},t,!e[t])):e}))}):c}))})),T((function(n){return(0,a.Z)((0,a.Z)({},n),{},(0,r.Z)({},e,!0))}))},A=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n){var t,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=C.find((function(e){return e.id===n})),r={id:t.id,name:t.name,permissions:t.permissions.map((function(e){return{id:e.id,module_id:e.module,can_create:e.can_create,can_view:e.can_view,can_edit:e.can_edit,can_delete:e.can_delete}}))},e.prev=2,e.next=5,(0,k.ZP)("user/roles/".concat(r.id,"/"),"PUT",r);case 5:"success"===e.sent.status?d.ZP.success("Permissions updated successfully"):d.ZP.error("Failed to update permissions"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),d.ZP.error("Error updating permissions: "+e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(n){return e.apply(this,arguments)}}(),K=function(e,n){E((function(t){return t.map((function(t,c){return c===e?(0,a.Z)((0,a.Z)({},t),{},(0,r.Z)({},n,!t[n])):t}))}))},O=[{title:"Module",dataIndex:"module",key:"module.id",render:function(e){return e.name}},{title:"Create",dataIndex:"can_create",key:"can_create",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return K(t,"can_create")}})}},{title:"View",dataIndex:"can_view",key:"can_view",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return K(t,"can_view")}})}},{title:"Edit",dataIndex:"can_edit",key:"can_edit",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return K(t,"can_edit")}})}},{title:"Delete",dataIndex:"can_delete",key:"can_delete",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return K(t,"can_delete")}})}}],V=[{title:"Module",dataIndex:"module",key:"module",render:function(e){return e.name}},{title:"Create",dataIndex:"can_create",key:"can_create",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return z(n.roleId,t,"can_create")}})}},{title:"View",dataIndex:"can_view",key:"can_view",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return z(n.roleId,t,"can_view")}})}},{title:"Edit",dataIndex:"can_edit",key:"can_edit",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return z(n.roleId,t,"can_edit")}})}},{title:"Delete",dataIndex:"can_delete",key:"can_delete",render:function(e,n,t){return(0,w.jsx)(l.Z,{checked:e,onChange:function(){return z(n.roleId,t,"can_delete")}})}}],B=[{title:"Roles",dataIndex:"name",key:"name"},{title:"Action",key:"action",fixed:"right",width:100,render:function(e,n){return N[n.id]?(0,w.jsx)(Z.ZP,{type:"primary",onClick:function(){return A(n.id)},children:"Update"}):null}}];return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("div",{className:"organization",children:[(0,w.jsxs)(m.Z,{justify:"space-between",style:{marginBottom:"25px"},children:[(0,w.jsx)(p.Z,{}),(0,w.jsx)(p.Z,{children:(0,w.jsx)(Z.ZP,{type:"primary",icon:(0,w.jsx)(_.Z,{}),onClick:function(){y(!0)},children:"Add Role"})})]}),(0,w.jsx)(f.Z,{dataSource:C,columns:B,expandable:{expandedRowRender:function(e){return console.log("Expanded Record:",e),(0,w.jsx)(f.Z,{columns:V,dataSource:e.permissions.map((function(n,t){return(0,a.Z)((0,a.Z)({},n),{},{key:t,roleId:e.id})})),pagination:!1,rowKey:"key"})}},rowKey:"id",scroll:{x:"max-content"}}),(0,w.jsx)(h.Z,{title:"Add New Role",open:t,onOk:function(){M.current.validateFields().then((function(e){var n=b.map((function(e){return{module_id:e.module.id,can_create:e.can_create,can_view:e.can_view,can_edit:e.can_edit,can_delete:e.can_delete}})),t={name:e.roleName,permissions:n};(0,k.ZP)("user/role/","POST",t).then((function(e){"success"===e.status?(d.ZP.success("Role created successfully"),console.log("New Role:",t),P([].concat((0,c.Z)(C),[e.data]))):d.ZP.error("Failed to create role")})).catch((function(e){d.ZP.error("Error creating role: "+e)})),M.current.resetFields(),y(!1)})).catch((function(e){console.log("Validate Failed:",e)}))},onCancel:function(){y(!1)},okText:"Submit",cancelText:"Cancel",width:800,style:{top:20},bodyStyle:{maxHeight:"70vh",overflowY:"auto",overflowX:"hidden"},children:(0,w.jsxs)(x.Z,{ref:M,layout:"vertical",name:"add_role_form",children:[(0,w.jsx)(x.Z.Item,{name:"roleName",label:"Role Name",rules:[{required:!0,message:"Please enter a role name"}],children:(0,w.jsx)(v.Z,{placeholder:"Enter Role Name"})}),(0,w.jsx)(f.Z,{columns:O,dataSource:b,pagination:!1,rowKey:"module.id"})]})})]})})}},1730:function(e,n,t){t.d(n,{Z:function(){return s}});var r=t(1413),a=t(2791),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},i=t(4291),o=function(e,n){return a.createElement(i.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:n,icon:c}))};o.displayName="SearchOutlined";var s=a.forwardRef(o)},2866:function(e,n,t){t.d(n,{F:function(){return o},Z:function(){return i}});var r=t(4942),a=t(1694),c=t.n(a);function i(e,n,t){var a;return c()((a={},(0,r.Z)(a,"".concat(e,"-status-success"),"success"===n),(0,r.Z)(a,"".concat(e,"-status-warning"),"warning"===n),(0,r.Z)(a,"".concat(e,"-status-error"),"error"===n),(0,r.Z)(a,"".concat(e,"-status-validating"),"validating"===n),(0,r.Z)(a,"".concat(e,"-has-feedback"),t),a))}var o=function(e,n){return n||e}},914:function(e,n,t){var r=t(9752);n.Z=r.Z},6106:function(e,n,t){var r=t(7545);n.Z=r.Z}}]);
//# sourceMappingURL=377.c25098e6.chunk.js.map